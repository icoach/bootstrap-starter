<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skywalk</title>

    <!-- Common stylesheet for all devices -->
    <link rel="stylesheet" href="./dist/stylesheets/skywalk.css">

    <!-- // <script src="./bower_components/handlebars/dist/handlebars.runtime.js"></script> -->
    <script src="./dist/javascripts/handlebars.js"></script>
    <!-- Place anything custom after this. -->
  </head>

  <body>

    <!-- Body
    ================================================== -->
    <div id="skywalkapp">

    <div id="auth" class="layer layer-inverse">
      <div id="auth-indicator" class="loading"></div>
      <div id="auth-message" class="loading-message">Calling Dropbox to authenticate you...</div>
    </div>

    </div><!-- /skywalkapp -->


    <!-- Javascripts
    ================================================== -->
     <script src="//www.dropbox.com/static/api/dropbox-datastores-1.0-latest.js"></script>
    <script>window.Dropbox || document.write('<script src="dist/javascripts/dropbox-datastores-1.0-latest.js">\x3C/script>')</script>


    <script src="dist/javascripts/yepnope.1.5.4-min.js" type="text/javascript"></script>

    <script>
      (function(window, document){

        window.dropboxClient = new Dropbox.Client({
          key: 'qyiormtv58xf75c'
        })

        dropboxClient.authenticate({ interactive: true }, function(error, client) {
          if (!client.isAuthenticated()) {
            // document.getElementById('auth-indicator').style.display = 'none'
            document.getElementById('auth-message').innerHTML = "I'am sorry, but Skywalk couldn't authenticate you. Please, check your Internet connection."

            // TODO: log this event
          }
          else {
            client.getAccountInfo({}, function(error, accountInfo, parsedData) {
              if (error) {
                // Unable to get Account Info, probably no internet connection
                document.getElementById('auth-message').innerHTML = "I'am sorry, but Skywalk couldn't authenticate you. Please, check your Internet connection."
              }
              else {
                // Save Current user to App Context
                window.dropboxClient['accountInfo'] = parsedData
                // var authElement = document.getElementById('auth')
                // authElement.parentElement.removeChild(authElement)

                // Load Skywalk
                yepnope('dist/javascripts/skywalk-compiled.js')
              }
            })
          }
        })

      }(window, document, undefined))
    </script>

  </body>
</html>
